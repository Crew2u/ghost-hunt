<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ghost Detector</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: monospace;
}

/* HUD overlay */
#hud {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
}

#status {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: #00ffcc;
  padding: 10px 18px;
  border: 1px solid #00ffcc;
  font-size: 14px;
  letter-spacing: 1px;
}

#reticle {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 80px;
  height: 80px;
  transform: translate(-50%, -50%);
  border: 2px solid rgba(0,255,204,0.6);
  border-radius: 50%;
  box-shadow: 0 0 20px rgba(0,255,204,0.4);
}
</style>
</head>

<body>

<!-- HUD -->
<div id="hud">
  <div id="reticle"></div>
  <div id="status">INITIALISING SENSOR ARRAYâ€¦</div>
</div>

<!-- AR Scene -->
<a-scene
  embedded
  vr-mode-ui="enabled: false"
  renderer="logarithmicDepthBuffer: true;"
>
  <a-entity camera look-controls></a-entity>

  <!-- Ghost -->
  <a-video
    id="ghost"
    src="ghost_realistic.webm"
    position="0 1.6 -3"
    width="2"
    height="3"
    visible="false"
    autoplay
    loop
    transparent="true"
  ></a-video>
</a-scene>

<script>
const status = document.getElementById("status");
const ghost = document.getElementById("ghost");

/* ðŸ”§ TEST COORDINATES (CHANGE THESE LATER) */
const GHOST_LAT = -26.652345;
const GHOST_LON = 152.866789;

/* Detection range */
const MAX_DISTANCE = 10; // metres

let ghostVisible = false;

/* Distance calculation */
function distanceMeters(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const toRad = d => d * Math.PI / 180;

  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);

  const a =
    Math.sin(dLat/2) ** 2 +
    Math.cos(toRad(lat1)) *
    Math.cos(toRad(lat2)) *
    Math.sin(dLon/2) ** 2;

  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

/* GPS Tracking */
navigator.geolocation.watchPosition(
  pos => {
    const dist = distanceMeters(
      pos.coords.latitude,
      pos.coords.longitude,
      GHOST_LAT,
      GHOST_LON
    );

    status.innerText = "SIGNAL RANGE: " + dist.toFixed(1) + " m";

    if (dist <= MAX_DISTANCE && !ghostVisible) {
      ghost.setAttribute("visible", "true");
      ghostVisible = true;
      status.innerText = "âš  ENTITY DETECTED";
    }

    if (dist > MAX_DISTANCE && ghostVisible) {
      ghost.setAttribute("visible", "false");
      ghostVisible = false;
    }
  },
  err => {
    status.innerText = "GPS ERROR â€” CHECK PERMISSIONS";
  },
  {
    enableHighAccuracy: true,
    maximumAge: 1000,
    timeout: 10000
  }
);
</script>

</body>
</html>
